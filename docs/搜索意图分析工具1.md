
# 搜索意图分析工具

## 目标与设计思想

**目标**：在不依赖任何机器学习模型的前提下，**仅靠规则**将关键词归入「主意图-子意图」共 24 个标签，并体现多意图概率。

**设计思想**：
1. 先看词面（80% 关键词可直接命中）
2. 再看 SERP 结构（解决同词多意图）
3. 最后用冲突优先级决胜负（给出主意图、次要意图及置信度）

## 1. 意图体系（6 主意图 × 24 子意图）

| 主意图     | 代码 | 子意图                                       | 说明                   |
|------------|------|----------------------------------------------|------------------------|
| 信息获取   | I    | I1 定义/概念<br>I2 原理/源码<br>I3 教程/步骤<br>I4 事实求证 | 用户尚未决定行动       |
| 导航直达   | N    | N1 官方主页<br>N2 登录/控制台<br>N3 下载/安装包 | 指向特定站点或文件     |
| 商业评估   | C    | C1 榜单/推荐<br>C2 对比/评测<br>C3 口碑/点评 | 寻找最佳或比较多个方案 |
| 交易购买   | E    | E1 价格/报价<br>E2 优惠/折扣<br>E3 下单/预订 | 已有明确交易意向       |
| 行为后续   | B    | B1 故障/报错<br>B2 高级用法<br>B3 配置/设置 | 已拥有产品，解决使用问题 |
| 本地/到店  | L    | L1 附近门店<br>L2 预约/路线<br>L3 开放时间 | O2O/地图式需求         |

## 2. 词面规则

**建议以 YAML 保存，便于脚本读取。优先级：子意图 > 主意图。**

```yaml
# keywords_dict.yaml 示例
I1: [what is, definition, mean, 意味, 是什么, 定义]
I2: [architecture, algorithm, 原理, 源码, protocol]
I3: [how to, tutorial, step by step, 教程, 方法, 步骤]
I4: [is ... good, true or false, 是否, 好吗, 真假]

N1: [official site, 官网, home page, 官方网站]
N2: [login, signin, 控制台, 后台, 登陆]
N3: [download, installer, setup.exe, 离线包, dmg]

C1: [best, top 10, 推荐, 排行, 榜单]
C2: [vs, versus, compare, 对比]
C3: [review, rating, 点评, 评价]

E1: [price, cost, 多少钱, 价格, quote]
E2: [coupon, discount, promo, 优惠, 折扣]
E3: [buy, purchase, order, 下单, 预订]

B1: [error, fix, troubleshoot, 报错, 解决]
B2: [advanced, pro tips, 高级, 进阶]
B3: [config, setting, 配置, 设置]

L1: [near me, 附近, 周边, <city>, 哪里有]
L2: [route, directions, 路线, 怎么去, 预约]
L3: [opening hours, 营业时间, 几点关门]
```

**匹配原则：**
1. 对关键词进行小写化、去符号、全角转半角
2. **子意图词**命中计 1 分，**主意图词**命中计 0.6 分
3. 可命中多个标签，分数累加

## 3. SERP 结构规则

通过抓取前 10 条结果的结构化信息（只保存解析结果）。同样用 YAML 定义。

```yaml
# serp_rules.yaml 示例
# 每个信号给主意图/子意图增加分值
shopping_ads:
  E: 0.8
  E3: 0.5
price_snippet:
  E: 0.6
  E1: 0.4
official_site:
  N: 0.8
  N1: 0.6
video_block:
  I: 0.4
  I3: 0.3
top_stories:
  I: 0.3
map_pack:
  L: 1.0
  L1: 0.6
stackoverflow:
  B: 0.8
  B1: 0.6
```

**SERP 信号识别要点：**
- `shopping_ads`：页面出现 `data-product-id=` 或包含 "Sponsored"+价格
- `price_snippet`：出现货币符号紧跟数字
- `official_site`：域名完全匹配品牌词+前缀 `/`，且带 sitelink
- `map_pack`：出现 `data-lat` & `data-lng`，或带"附近"结果卡

## 4. 冲突消解与概率计算

1. 对每个意图累加：  
   `Score = Σ(词面分) + Σ(SERP分)`
2. 归一化为概率：  
   `P(intent) = Score / ΣScore`
3. 主意图 = 最高概率；次意图 = 第二高且 P ≥ 0.2 时输出
4. 子意图按同样方法在主意图所属的子类中比较得分。若无子意图命中则留空

### 示例计算

- **关键词**：`iphone 16 price review`
- **词面**：`price → E1+1`，`review → C3+1`
- **SERP**：出现购物广告 (`E+0.8`, `E3+0.5`)
- **分数**：
  - E = 1 (E1) + 0.8 (E) = 1.8
  - C = 1 (C3)
- **归一化**：
  - P(E) = 1.8 / (1.8 + 1) = 0.64
  - P(C) = 1 / (1.8 + 1) = 0.36
- **输出**：
  - 主意图 = E
  - 次意图 = C
  - 子意图 = E1
  - 置信度 = {E: 0.64, C: 0.36}

## 5. 输出字段

| 字段                | 含义                                       |
|---------------------|-------------------------------------------|
| query               | 原关键词                                   |
| intent_primary      | 主意图（I / N / C / E / B / L）           |
| intent_secondary    | 次意图（如有则显示，否则留空）             |
| sub_intent          | 子意图（I3 / E1 …）                        |
| probability         | 主意图概率（0-1，四舍五入两位）            |
| probability_secondary | 次意图概率                               |
| signals_hit         | 命中的关键词或 SERP 信号（用于审计）       |

## 6. 维护与扩展

1. 每周将未命中但搜索量超过阈值的关键词追加到 `pending_review.txt`，人工标注后更新 YAML
2. SERP 规则只增不删，历史分值可微调
3. 若需支持多语种，直接复制当前 YAML，替换为目标语言关键词

## 7. 最低实现 Checklist

- [ ] 关键词预处理（大小写、分词）
- [ ] 关键词字典 YAML 加载
- [ ] SERP 抓取并解析 8 个核心信号
- [ ] 按上述公式计算分数与概率
- [ ] 冲突消解、字段输出

**完成以上五步即可在无需模型训练的情况下，稳定达到 ≈80% 的意图识别准确率。**
