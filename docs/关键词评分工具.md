# 关键词评分工具

**文件名**: `keyword_scorer.py`

## 功能概述

关键词评分工具用于对关键词进行综合评分和排序，帮助识别高潜力的关键词机会。评分基于多个维度，包括搜索量、增长率、关键词难度和KGR(Keyword Golden Ratio)等，可以根据需求自定义权重。

## 使用方法

### 基本用法

```bash
# 基础使用（包含KGR计算）
python keyword_scorer.py --input data/trends_all_2025-08-04.csv --enrich

# 自定义KGR权重
python keyword_scorer.py --input data/trends_all_2025-08-04.csv --kgr-weight 0.3

# 禁用KGR计算
python keyword_scorer.py --input data/trends_all_2025-08-04.csv --no-kgr
```

### KGR功能测试

```bash
# 运行KGR功能测试
python test_kgr_functionality.py
```

### 参数说明

- `--input`：输入CSV文件路径（必需）
- `--enrich`：是否丰富数据（添加搜索量、CPC等）
- `--volume-weight`：搜索量权重，默认0.4
- `--growth-weight`：增长率权重，默认0.4
- `--kd-weight`：关键词难度权重，默认0.2
- `--min-score`：最低评分过滤
- `--output`：输出目录，默认为data
- `--volume-col`：搜索量列名，默认为"monthly_searches"
- `--growth-col`：增长率列名，默认为"growth"
- `--kd-col`：关键词难度列名，默认为"keyword_difficulty"

### 输出说明

工具会生成以下文件：

1. `scored_YYYY-MM-DD.csv`：包含所有关键词的评分结果
2. `scored_high_score_YYYY-MM-DD.csv`：高分关键词（分数>=70）

CSV文件包含以下字段：
- 原始数据的所有字段
- `volume_score`：搜索量评分（0-100）
- `growth_score`：增长率评分（0-100）
- `kd_score`：关键词难度评分（0-100）
- `score`：综合评分（0-100）
- `grade`：等级（S/A/B/C/D）

## 技术细节

### 评分算法

1. **归一化**：将各维度数据归一化到0-100范围
   ```
   normalized_value = (value - min_value) / (max_value - min_value) * 100
   ```

2. **KGR计算**：计算关键词黄金比例
   ```
   KGR = 标题中包含完整关键词的搜索结果数量 / 月搜索量
   ```
   
   KGR评分规则：
   - KGR < 0.25: 优秀 (90-100分) - 竞争较小，容易排名
   - KGR 0.25-0.5: 良好 (70-89分) - 适度竞争
   - KGR 0.5-1.0: 一般 (40-69分) - 竞争较大
   - KGR > 1.0: 困难 (0-39分) - 竞争激烈

3. **加权计算**：根据权重计算综合评分
   ```
   score = volume_weight * volume_score + growth_weight * growth_score + 
           kd_weight * kd_score + kgr_weight * kgr_score
   ```
   
   默认权重配置：
   - 搜索量权重：30%
   - 增长率权重：30%
   - 关键词难度权重：20%
   - KGR权重：20%

4. **等级划分**：
   - A级：70-100分
   - B级：50-69分
   - C级：30-49分
   - D级：0-29分

### 数据丰富

如果启用了`--enrich`选项，工具会添加以下模拟数据：
- `monthly_searches`：月搜索量
- `competition`：竞争度（0-1）
- `cpc`：平均点击成本（美元）

在实际应用中，这些数据可以从Google Ads API或其他SEO工具API获取。

### 代码结构

```python
class KeywordScorer:
    def __init__(self, volume_weight=0.3, growth_weight=0.3, 
                 kd_weight=0.2, kgr_weight=0.2):
        # 初始化设置，包含KGR权重
        
    def calculate_kgr(self, keyword, monthly_searches, serp_analyzer=None):
        # 计算关键词黄金比例
        
    def calculate_kgr_score(self, kgr_value):
        # 将KGR值转换为评分
        
    def score_keywords(self, df, volume_col=None, growth_col=None, 
                      kd_col=None, keyword_col='query', 
                      serp_analyzer=None, calculate_kgr=True):
        # 评分计算，包含KGR
        
    def normalize_values(self, values):
        # 归一化数值
        
    def filter_keywords(self, df, min_score=None):
        # 过滤低分关键词
```

### 代码使用示例

```python
import pandas as pd
from src.demand_mining.analyzers.keyword_scorer import KeywordScorer
from src.demand_mining.analyzers.serp_analyzer import SerpAnalyzer

# 创建测试数据
df = pd.DataFrame({
    'query': ['ai tools', 'best ai writing tools', 'how to use chatgpt'],
    'value': [5000, 1200, 800],  # 搜索量
    'growth': [50, 120, 30],     # 增长率
    'monthly_searches': [5000, 1200, 800]  # 月搜索量
})

# 方法1: 使用模拟数据计算KGR
scorer = KeywordScorer(kgr_weight=0.25)  # 增加KGR权重
result = scorer.score_keywords(df, calculate_kgr=True)
print(result[['query', 'kgr_value', 'kgr_score', 'kgr_grade', 'score']])

# 方法2: 使用真实SERP数据计算KGR（需要API配置）
try:
    serp_analyzer = SerpAnalyzer()
    result_real = scorer.score_keywords(
        df, 
        serp_analyzer=serp_analyzer, 
        calculate_kgr=True
    )
except:
    print("SERP分析器需要Google API配置")

# 方法3: 禁用KGR计算
result_no_kgr = scorer.score_keywords(df, calculate_kgr=False)
```

## 示例输出

```
query,value,monthly_searches,volume_score,growth_score,kd_score,kgr_value,kgr_score,kgr_grade,score,grade
ai tools,5000,5000,100.0,25.0,50,0.1200,95.2,A,67.6,B
best ai writing tools,1200,1200,28.6,100.0,50,0.8333,52.5,C,64.0,B
how to use chatgpt,800,800,19.0,0.0,50,0.1875,92.5,A,40.4,C
...
```

### 输出列说明

- `query`: 关键词
- `value`: 原始搜索量
- `monthly_searches`: 月搜索量
- `volume_score`: 搜索量评分 (0-100)
- `growth_score`: 增长率评分 (0-100)
- `kd_score`: 关键词难度评分 (0-100)
- `kgr_value`: KGR值 (越小越好)
- `kgr_score`: KGR评分 (0-100)
- `kgr_grade`: KGR等级 (A/B/C/D/F)
- `score`: 综合评分 (0-100)
- `grade`: 综合等级 (A/B/C/D)

## 注意事项

- 评分权重总和应为1.0，如果不是，脚本会自动归一化
- 如果输入数据缺少某些列，相应的评分维度会被忽略或使用默认值
- 模拟数据仅供演示，实际应用中应使用真实数据源

## 功能特性

### ✅ 已实现功能

- **KGR (Keyword Golden Ratio) 计算**: 评估关键词排名机会
- **多维度评分**: 搜索量、增长率、关键词难度、KGR综合评分
- **灵活权重配置**: 可自定义各维度权重
- **真实SERP数据支持**: 可使用Google Custom Search API获取真实数据
- **模拟数据模式**: 无API配置时使用智能估算
- **等级评定**: 自动分配A/B/C/D等级
- **批量处理**: 支持大量关键词批量分析
- **建站建议**: 基于搜索意图的智能建站建议系统

### 🔄 未来改进

- 集成更多SEO工具API (Ahrefs, SEMrush等)
- 添加更多评分维度，如转化率、点击率等
- 支持自定义评分公式和等级划分
- 添加历史数据比较功能
- 实现可视化评分结果
- 优化KGR计算性能和准确性